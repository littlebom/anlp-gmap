<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Learn - Category View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { background: '#0B1120', surface: '#1E293B', primary: '#38bdf8', secondary: '#818cf8', accent: '#2dd4bf' }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
            background: #0B1120;
        }

        .bg-grid {
            background-size: 60px 60px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-4px);
            }
        }

        @keyframes pulseRing {

            0%,
            100% {
                opacity: 0.15;
                transform: scale(1);
            }

            50% {
                opacity: 0.3;
                transform: scale(1.03);
            }
        }

        @keyframes dashFlow {
            to {
                stroke-dashoffset: -16;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .node-float {
            animation: float 5s ease-in-out infinite;
        }

        .edge-line {
            stroke-dasharray: 6;
            animation: dashFlow 2s linear infinite;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out both;
        }

        #graph {
            cursor: grab;
            user-select: none;
        }

        #graph:active {
            cursor: grabbing;
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 2px;
        }

        .tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 10px 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 100;
            backdrop-filter: blur(8px);
            max-width: 280px;
        }

        .tooltip.visible {
            opacity: 1;
        }
    </style>
</head>

<body class="text-slate-400 antialiased h-screen flex overflow-hidden">

    <!-- BG effects -->
    <div class="fixed inset-0 bg-grid pointer-events-none z-0"></div>
    <div class="fixed top-0 left-1/3 w-[600px] h-[600px] bg-sky-500/5 blur-[120px] rounded-full pointer-events-none">
    </div>
    <div
        class="fixed bottom-0 right-1/4 w-[500px] h-[500px] bg-violet-500/5 blur-[120px] rounded-full pointer-events-none">
    </div>

    <!-- ===== SIDEBAR ===== -->
    <aside class="w-64 border-r border-slate-800 bg-[#0B1120]/80 backdrop-blur-xl flex flex-col z-30 shrink-0">
        <div class="h-12 flex items-center px-4 border-b border-slate-800/50">
            <div
                class="w-6 h-6 rounded-md bg-gradient-to-br from-sky-500 to-indigo-500 flex items-center justify-center mr-2 shadow shadow-sky-500/20">
                <i data-lucide="orbit" class="w-3.5 h-3.5 text-white"></i>
            </div>
            <span class="text-slate-200 font-bold text-sm tracking-tight">AI-Learn Galaxy</span>
        </div>

        <nav class="flex-1 overflow-y-auto px-3 pt-3 space-y-4">
            <!-- Search -->
            <div class="relative">
                <i data-lucide="search"
                    class="w-3.5 h-3.5 text-slate-500 absolute left-2.5 top-1/2 -translate-y-1/2"></i>
                <input id="searchInput" type="text" placeholder="ค้นหาอาชีพ..."
                    class="w-full pl-8 pr-3 py-1.5 rounded-lg bg-slate-800/50 border border-slate-700/50 text-xs text-slate-200 placeholder:text-slate-600 focus:outline-none focus:border-primary/50 transition-colors">
            </div>

            <!-- Back to Galaxy -->
            <a href="mockup_galaxy.html"
                class="flex items-center gap-2 px-2 py-1.5 rounded-lg bg-slate-800/30 border border-slate-700/30 text-xs text-slate-400 hover:text-primary hover:border-primary/30 transition-all">
                <i data-lucide="arrow-left" class="w-3.5 h-3.5"></i> Back to Galaxy
            </a>

            <!-- Clusters list -->
            <div>
                <h3 class="text-[9px] font-semibold text-slate-500 uppercase tracking-wider mb-2 px-1">Categories (8)
                </h3>
                <ul id="categoryList" class="space-y-1"></ul>
            </div>

            <!-- Current category stats -->
            <div class="px-1 space-y-1.5">
                <h3 class="text-[9px] font-semibold text-slate-500 uppercase tracking-wider mb-2">Category Stats</h3>
                <div class="flex justify-between text-[11px]"><span class="text-slate-500">Jobs in Category</span><span
                        class="text-slate-200 font-bold" id="statJobs">0</span></div>
                <div class="flex justify-between text-[11px]"><span class="text-slate-500">Total Skills</span><span
                        class="text-slate-200 font-bold" id="statSkills">0</span></div>
                <div class="flex justify-between text-[11px]"><span class="text-slate-500">Shared Within</span><span
                        class="text-yellow-400 font-bold" id="statSharedIn">0</span></div>
                <div class="flex justify-between text-[11px]"><span class="text-slate-500">Cross-Category</span><span
                        class="text-orange-400 font-bold" id="statSharedOut">0</span></div>
            </div>

            <!-- Legend -->
            <div class="px-1">
                <h3 class="text-[9px] font-semibold text-slate-500 uppercase tracking-wider mb-2">Legend</h3>
                <div class="space-y-1">
                    <div class="flex items-center gap-2 text-[10px]"><span
                            class="w-4 h-1 rounded-full bg-yellow-400/60"></span><span class="text-slate-500">Shared
                            within category</span></div>
                    <div class="flex items-center gap-2 text-[10px]"><span
                            class="w-4 h-1 rounded-full bg-orange-400/60"></span><span
                            class="text-slate-500">Cross-category shared</span></div>
                    <div class="flex items-center gap-2 text-[10px]"><span
                            class="w-3 h-3 rounded-full border border-slate-600"></span><span class="text-slate-500">L2
                            Job Title node</span></div>
                </div>
            </div>
        </nav>

        <div class="p-3 border-t border-slate-800/50 text-[10px] text-slate-600 text-center">
            Click job to view skills • Drag to pan
        </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="flex-1 relative z-10 flex flex-col overflow-hidden">

        <!-- Top bar -->
        <div
            class="h-12 flex items-center justify-between px-5 z-40 border-b border-slate-800/30 bg-[#0B1120]/80 backdrop-blur shrink-0">
            <div>
                <div class="flex items-center gap-1.5 text-[10px] text-slate-500">
                    <a href="mockup_galaxy.html" class="hover:text-primary transition-colors">Galaxy</a>
                    <i data-lucide="chevron-right" class="w-3 h-3"></i>
                    <span class="text-primary font-medium" id="breadcrumbCat">Category</span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <span
                    class="px-2 py-0.5 rounded bg-slate-800/80 border border-slate-700 text-[10px] text-slate-400 font-mono"
                    id="nodeCount">0 jobs</span>
            </div>
        </div>

        <!-- Category Header -->
        <div class="px-6 py-4 border-b border-slate-800/20 shrink-0 fade-in">
            <div class="flex items-center gap-4">
                <div id="catIcon" class="w-14 h-14 rounded-2xl flex items-center justify-center shadow-xl border-2"
                    style="background:linear-gradient(135deg,#38bdf830,#38bdf810);border-color:#38bdf840">
                    <i data-lucide="code" class="w-7 h-7 text-primary"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-slate-100 tracking-tight" id="catTitle">Software Development</h1>
                    <p class="text-sm text-slate-500 mt-0.5" id="catDesc">7 occupations • 171 total skills</p>
                </div>
                <div class="ml-auto flex gap-2">
                    <span
                        class="px-2.5 py-1 rounded-lg bg-yellow-500/10 border border-yellow-500/20 text-[10px] text-yellow-400 font-bold"
                        id="badgeSharedIn">12 shared within</span>
                    <span
                        class="px-2.5 py-1 rounded-lg bg-orange-500/10 border border-orange-500/20 text-[10px] text-orange-400 font-bold"
                        id="badgeSharedOut">4 cross-category</span>
                </div>
            </div>
        </div>

        <!-- Content: Graph + Cards -->
        <div class="flex-1 flex overflow-hidden">

            <!-- Graph area -->
            <div class="flex-1 relative overflow-hidden" id="graph">
                <div id="tooltip" class="tooltip">
                    <p class="text-xs text-slate-200 font-semibold" id="ttTitle"></p>
                    <p class="text-[10px] text-slate-400 mt-1" id="ttDesc"></p>
                </div>
                <div id="world" class="absolute" style="transform-origin: 0 0;">
                    <svg id="svgLayer" class="absolute pointer-events-none"
                        style="width:2000px;height:1600px;overflow:visible"></svg>
                    <div id="nodeLayer" class="absolute" style="width:2000px;height:1600px;"></div>
                </div>
            </div>

            <!-- Right panel: Job Cards with L3 preview -->
            <div class="w-72 border-l border-slate-800/30 overflow-y-auto bg-[#0B1120]/40 backdrop-blur px-4 py-4 space-y-3 shrink-0"
                id="jobCardsPanel">
                <h3 class="text-[9px] font-semibold text-slate-500 uppercase tracking-wider px-1">L2 Job Titles</h3>
                <div id="jobCards" class="space-y-2"></div>

                <h3 class="text-[9px] font-semibold text-slate-500 uppercase tracking-wider px-1 mt-4">Cross-Category
                    Links</h3>
                <div id="crossLinks" class="space-y-1.5"></div>
            </div>
        </div>
    </main>

    <script>
        // ============================================================
        //  DATA (shared with galaxy)
        // ============================================================
        const CATEGORIES = [
            { id: 'softdev', name: 'Software Development', color: '#38bdf8', icon: 'code', desc: 'Web, Mobile, Embedded, Game development' },
            { id: 'data', name: 'Data & AI', color: '#a78bfa', icon: 'brain', desc: 'Data Science, Machine Learning, NLP' },
            { id: 'infra', name: 'Infrastructure & Cloud', color: '#34d399', icon: 'cloud', desc: 'DevOps, SRE, Cloud Architecture' },
            { id: 'security', name: 'Cybersecurity', color: '#f87171', icon: 'shield', desc: 'Security Analysis, Pen Testing, Forensics' },
            { id: 'design', name: 'Design & UX', color: '#fbbf24', icon: 'pen-tool', desc: 'UI/UX Design, Graphics, Motion' },
            { id: 'pm', name: 'Product & Management', color: '#4ade80', icon: 'clipboard-list', desc: 'Product, Project, Engineering Management' },
            { id: 'qa', name: 'Quality & Testing', color: '#22d3ee', icon: 'test-tubes', desc: 'QA, Automation, Performance Testing' },
            { id: 'acad', name: 'Education & Research', color: '#e879f9', icon: 'graduation-cap', desc: 'Tech Education, Curriculum, Research' },
        ];

        const JOBS = [
            // Software Dev
            { id: 'python_dev', name: 'Python Developer', cat: 'softdev', skills: 24, topSkills: ['OOP', 'Flask', 'Testing', 'SQL', 'Git'] },
            { id: 'frontend_dev', name: 'Frontend Developer', cat: 'softdev', skills: 26, topSkills: ['React', 'TypeScript', 'CSS', 'Testing', 'Git'] },
            { id: 'backend_dev', name: 'Backend Developer', cat: 'softdev', skills: 25, topSkills: ['Django', 'API Design', 'SQL', 'Docker', 'Auth'] },
            { id: 'fullstack', name: 'Fullstack Developer', cat: 'softdev', skills: 30, topSkills: ['React', 'Node.js', 'SQL', 'Docker', 'Git'] },
            { id: 'mobile_dev', name: 'Mobile Developer', cat: 'softdev', skills: 22, topSkills: ['Flutter', 'Swift', 'OOP', 'REST API', 'CI/CD'] },
            { id: 'game_dev', name: 'Game Developer', cat: 'softdev', skills: 20, topSkills: ['Unity', 'C#', 'Physics', 'OOP', 'Shaders'] },
            { id: 'embedded', name: 'Embedded Engineer', cat: 'softdev', skills: 18, topSkills: ['C/C++', 'RTOS', 'Hardware', 'Linux', 'Testing'] },
            // Data & AI
            { id: 'data_sci', name: 'Data Scientist', cat: 'data', skills: 28, topSkills: ['Python', 'Statistics', 'ML', 'SQL', 'Visualization'] },
            { id: 'ml_eng', name: 'ML Engineer', cat: 'data', skills: 26, topSkills: ['PyTorch', 'MLOps', 'Python', 'Docker', 'Cloud'] },
            { id: 'data_eng', name: 'Data Engineer', cat: 'data', skills: 24, topSkills: ['Spark', 'SQL', 'Airflow', 'Python', 'Cloud'] },
            { id: 'data_analyst', name: 'Data Analyst', cat: 'data', skills: 18, topSkills: ['SQL', 'Excel', 'Tableau', 'Statistics', 'Python'] },
            { id: 'ai_research', name: 'AI Researcher', cat: 'data', skills: 22, topSkills: ['Deep Learning', 'Math', 'Python', 'Papers', 'NLP'] },
            { id: 'nlp_eng', name: 'NLP Engineer', cat: 'data', skills: 20, topSkills: ['Transformers', 'Python', 'Linguistics', 'ML', 'Cloud'] },
            // Infra
            { id: 'devops', name: 'DevOps Engineer', cat: 'infra', skills: 22, topSkills: ['Docker', 'K8s', 'CI/CD', 'Linux', 'Terraform'] },
            { id: 'sre', name: 'SRE', cat: 'infra', skills: 20, topSkills: ['Monitoring', 'Linux', 'K8s', 'Python', 'Incident Mgmt'] },
            { id: 'cloud_arch', name: 'Cloud Architect', cat: 'infra', skills: 24, topSkills: ['AWS/GCP/Azure', 'Networking', 'Security', 'Terraform', 'Cost Mgmt'] },
            { id: 'sys_admin', name: 'System Admin', cat: 'infra', skills: 18, topSkills: ['Linux', 'Networking', 'Scripting', 'Backup', 'Security'] },
            { id: 'net_eng', name: 'Network Engineer', cat: 'infra', skills: 16, topSkills: ['TCP/IP', 'Routing', 'Firewalls', 'VPN', 'Monitoring'] },
            { id: 'platform', name: 'Platform Engineer', cat: 'infra', skills: 21, topSkills: ['K8s', 'IaC', 'CI/CD', 'Docker', 'Observability'] },
            // Security
            { id: 'sec_analyst', name: 'Security Analyst', cat: 'security', skills: 18, topSkills: ['SIEM', 'Threat Analysis', 'Compliance', 'Networking', 'Forensics'] },
            { id: 'pen_tester', name: 'Penetration Tester', cat: 'security', skills: 20, topSkills: ['Kali', 'OWASP', 'Scripting', 'Networking', 'Reporting'] },
            { id: 'sec_arch', name: 'Security Architect', cat: 'security', skills: 22, topSkills: ['IAM', 'Cloud Security', 'Encryption', 'Architecture', 'Compliance'] },
            { id: 'soc_analyst', name: 'SOC Analyst', cat: 'security', skills: 16, topSkills: ['SIEM', 'Incident Response', 'Monitoring', 'Triage', 'Reporting'] },
            { id: 'forensics', name: 'Digital Forensics', cat: 'security', skills: 15, topSkills: ['Disk Analysis', 'Memory Forensics', 'Chain of Custody', 'Malware', 'Reporting'] },
            // Design
            { id: 'ui_designer', name: 'UI Designer', cat: 'design', skills: 16, topSkills: ['Figma', 'Design Systems', 'Typography', 'Color Theory', 'Prototyping'] },
            { id: 'ux_designer', name: 'UX Designer', cat: 'design', skills: 18, topSkills: ['User Research', 'Wireframing', 'Usability Testing', 'Figma', 'IA'] },
            { id: 'ux_research', name: 'UX Researcher', cat: 'design', skills: 14, topSkills: ['Interviews', 'Survey Design', 'A/B Testing', 'Analytics', 'Reporting'] },
            { id: 'graphic', name: 'Graphic Designer', cat: 'design', skills: 15, topSkills: ['Photoshop', 'Illustrator', 'Branding', 'Layout', 'Print'] },
            { id: 'motion', name: 'Motion Designer', cat: 'design', skills: 14, topSkills: ['After Effects', 'Animation', 'Storyboarding', '3D', 'Video'] },
            // PM
            { id: 'prod_mgr', name: 'Product Manager', cat: 'pm', skills: 15, topSkills: ['Roadmapping', 'Stakeholders', 'Analytics', 'Agile', 'Strategy'] },
            { id: 'proj_mgr', name: 'Project Manager', cat: 'pm', skills: 14, topSkills: ['Gantt', 'Risk Mgmt', 'Budget', 'Communication', 'Agile'] },
            { id: 'scrum_master', name: 'Scrum Master', cat: 'pm', skills: 12, topSkills: ['Scrum', 'Facilitation', 'Kanban', 'Coaching', 'Metrics'] },
            { id: 'tech_lead', name: 'Tech Lead', cat: 'pm', skills: 20, topSkills: ['Architecture', 'Code Review', 'Mentoring', 'Agile', 'System Design'] },
            { id: 'eng_mgr', name: 'Engineering Manager', cat: 'pm', skills: 18, topSkills: ['1:1s', 'Hiring', 'Performance', 'Strategy', 'Agile'] },
            // QA
            { id: 'qa_eng', name: 'QA Engineer', cat: 'qa', skills: 19, topSkills: ['Test Planning', 'Manual Testing', 'Bug Tracking', 'SQL', 'API Testing'] },
            { id: 'qa_auto', name: 'QA Automation', cat: 'qa', skills: 20, topSkills: ['Selenium', 'Cypress', 'CI/CD', 'Python', 'Test Frameworks'] },
            { id: 'perf_eng', name: 'Performance Engineer', cat: 'qa', skills: 17, topSkills: ['JMeter', 'Load Testing', 'Profiling', 'Monitoring', 'Optimization'] },
            { id: 'qa_lead', name: 'QA Lead', cat: 'qa', skills: 16, topSkills: ['Strategy', 'Team Mgmt', 'Metrics', 'Process', 'Automation'] },
            // Education
            { id: 'instructor', name: 'Tech Instructor', cat: 'acad', skills: 14, topSkills: ['Pedagogy', 'Curriculum', 'Presentation', 'LMS', 'Assessment'] },
            { id: 'curriculum', name: 'Curriculum Designer', cat: 'acad', skills: 12, topSkills: ['Learning Design', 'Bloom Taxonomy', 'Assessment', 'EdTech', 'Writing'] },
            { id: 'edtech', name: 'EdTech Developer', cat: 'acad', skills: 18, topSkills: ['React', 'LMS Integration', 'API', 'UX', 'Python'] },
            { id: 'researcher', name: 'CS Researcher', cat: 'acad', skills: 16, topSkills: ['LaTeX', 'Statistics', 'Python', 'Literature Review', 'Experimentation'] },
        ];

        // Cross-category shared
        const SHARED_LINKS = [
            { from: 'softdev', to: 'data', shared: 15, top: 'Python, Git, SQL' },
            { from: 'softdev', to: 'infra', shared: 12, top: 'Linux, Docker, CI/CD' },
            { from: 'softdev', to: 'qa', shared: 10, top: 'Testing, Git, Automation' },
            { from: 'softdev', to: 'security', shared: 8, top: 'Auth, Encryption, OWASP' },
            { from: 'softdev', to: 'design', shared: 6, top: 'HTML/CSS, Prototyping' },
            { from: 'softdev', to: 'pm', shared: 7, top: 'Agile, Communication' },
            { from: 'data', to: 'infra', shared: 9, top: 'Python, Cloud, Pipelines' },
            { from: 'data', to: 'acad', shared: 8, top: 'Statistics, Research, Python' },
            { from: 'data', to: 'qa', shared: 5, top: 'Automation, Scripting' },
            { from: 'infra', to: 'security', shared: 11, top: 'Networking, IAM, Monitoring' },
            { from: 'infra', to: 'qa', shared: 6, top: 'CI/CD, Monitoring, Docker' },
            { from: 'design', to: 'pm', shared: 7, top: 'User Research, Communication' },
            { from: 'design', to: 'acad', shared: 4, top: 'Presentation, Pedagogy' },
            { from: 'pm', to: 'qa', shared: 5, top: 'Agile, Metrics, Reporting' },
            { from: 'pm', to: 'acad', shared: 4, top: 'Communication, Planning' },
            { from: 'security', to: 'qa', shared: 4, top: 'Pen Testing, Automation' },
        ];

        // Within-category shared skills (between job pairs)
        const WITHIN_SHARED = {
            softdev: [
                { a: 'python_dev', b: 'backend_dev', shared: 12, top: 'OOP, SQL, Git, Testing' },
                { a: 'python_dev', b: 'fullstack', shared: 10, top: 'OOP, SQL, Git, API' },
                { a: 'frontend_dev', b: 'fullstack', shared: 14, top: 'React, TypeScript, CSS, Git' },
                { a: 'backend_dev', b: 'fullstack', shared: 13, top: 'SQL, Docker, API, Auth' },
                { a: 'python_dev', b: 'mobile_dev', shared: 6, top: 'OOP, REST API, CI/CD' },
                { a: 'game_dev', b: 'mobile_dev', shared: 5, top: 'OOP, UI, Performance' },
                { a: 'embedded', b: 'backend_dev', shared: 4, top: 'Linux, Testing, C/C++' },
            ],
            data: [
                { a: 'data_sci', b: 'ml_eng', shared: 15, top: 'Python, ML, Statistics, Cloud' },
                { a: 'data_sci', b: 'data_eng', shared: 10, top: 'Python, SQL, Cloud' },
                { a: 'data_sci', b: 'data_analyst', shared: 9, top: 'SQL, Statistics, Visualization' },
                { a: 'ml_eng', b: 'ai_research', shared: 11, top: 'Deep Learning, Python, Math' },
                { a: 'ml_eng', b: 'nlp_eng', shared: 10, top: 'Transformers, Python, ML' },
                { a: 'data_eng', b: 'data_analyst', shared: 7, top: 'SQL, Python, Data Pipelines' },
                { a: 'ai_research', b: 'nlp_eng', shared: 8, top: 'NLP, Deep Learning, Python' },
            ],
            infra: [
                { a: 'devops', b: 'sre', shared: 12, top: 'K8s, Linux, Monitoring, CI/CD' },
                { a: 'devops', b: 'platform', shared: 14, top: 'K8s, Docker, CI/CD, IaC' },
                { a: 'devops', b: 'cloud_arch', shared: 10, top: 'Terraform, Cloud, K8s' },
                { a: 'sre', b: 'sys_admin', shared: 8, top: 'Linux, Monitoring, Networking' },
                { a: 'cloud_arch', b: 'net_eng', shared: 6, top: 'Networking, Security, Cloud' },
                { a: 'sys_admin', b: 'net_eng', shared: 7, top: 'Networking, Linux, Security' },
            ],
            security: [
                { a: 'sec_analyst', b: 'soc_analyst', shared: 10, top: 'SIEM, Threat Analysis, Monitoring' },
                { a: 'sec_analyst', b: 'forensics', shared: 7, top: 'Forensics, Reporting, Malware' },
                { a: 'pen_tester', b: 'sec_arch', shared: 8, top: 'OWASP, Networking, Encryption' },
                { a: 'sec_arch', b: 'sec_analyst', shared: 6, top: 'Compliance, IAM, Architecture' },
                { a: 'soc_analyst', b: 'forensics', shared: 5, top: 'Incident Response, Triage' },
            ],
            design: [
                { a: 'ui_designer', b: 'ux_designer', shared: 10, top: 'Figma, Prototyping, User Research' },
                { a: 'ui_designer', b: 'graphic', shared: 6, top: 'Typography, Color Theory, Layout' },
                { a: 'ux_designer', b: 'ux_research', shared: 9, top: 'User Research, Usability Testing' },
                { a: 'graphic', b: 'motion', shared: 5, top: 'Design Tools, Visual Design' },
            ],
            pm: [
                { a: 'prod_mgr', b: 'proj_mgr', shared: 7, top: 'Agile, Stakeholders, Communication' },
                { a: 'prod_mgr', b: 'tech_lead', shared: 6, top: 'Strategy, Architecture, Agile' },
                { a: 'tech_lead', b: 'eng_mgr', shared: 9, top: 'Mentoring, Code Review, Agile' },
                { a: 'proj_mgr', b: 'scrum_master', shared: 6, top: 'Agile, Facilitation, Metrics' },
                { a: 'eng_mgr', b: 'prod_mgr', shared: 5, top: 'Strategy, Hiring, Performance' },
            ],
            qa: [
                { a: 'qa_eng', b: 'qa_auto', shared: 11, top: 'Test Planning, Bug Tracking, API Testing' },
                { a: 'qa_eng', b: 'qa_lead', shared: 7, top: 'Strategy, Metrics, Process' },
                { a: 'qa_auto', b: 'perf_eng', shared: 6, top: 'CI/CD, Automation, Profiling' },
                { a: 'qa_lead', b: 'qa_auto', shared: 5, top: 'Automation, Strategy, Metrics' },
            ],
            acad: [
                { a: 'instructor', b: 'curriculum', shared: 8, top: 'Pedagogy, Assessment, LMS' },
                { a: 'curriculum', b: 'edtech', shared: 5, top: 'EdTech, LMS, Learning Design' },
                { a: 'instructor', b: 'edtech', shared: 4, top: 'LMS, Presentation, EdTech' },
                { a: 'researcher', b: 'instructor', shared: 3, top: 'Statistics, Python, Writing' },
            ],
        };

        // ============================================================
        //  READ URL PARAM
        // ============================================================
        const urlParams = new URLSearchParams(window.location.search);
        const currentCatId = urlParams.get('cat') || 'softdev';
        const currentCat = CATEGORIES.find(c => c.id === currentCatId) || CATEGORIES[0];
        const catJobs = JOBS.filter(j => j.cat === currentCatId);
        const catSharedWithin = WITHIN_SHARED[currentCatId] || [];
        const catSharedCross = SHARED_LINKS.filter(l => l.from === currentCatId || l.to === currentCatId);

        // ============================================================
        //  LAYOUT
        // ============================================================
        const CX = 1000, CY = 800;
        function layoutCatJobs() {
            const count = catJobs.length;
            catJobs.forEach((job, i) => {
                const angle = (i / count) * Math.PI * 2 - Math.PI / 2;
                const r = 200 + (i % 2) * 80;
                job.x = CX + Math.cos(angle) * r;
                job.y = CY + Math.sin(angle) * r;
            });
        }
        layoutCatJobs();

        // ============================================================
        //  RENDER
        // ============================================================
        let scale = 0.65, panX = 0, panY = 0;

        function applyTransform() {
            const w = document.getElementById('world');
            const gw = document.getElementById('graph').clientWidth;
            const gh = document.getElementById('graph').clientHeight;
            const offsetX = gw / 2 - CX * scale + panX;
            const offsetY = gh / 2 - CY * scale + panY;
            w.style.transform = `translate(${offsetX}px,${offsetY}px) scale(${scale})`;
        }

        function renderAll() {
            renderHeader();
            renderSidebar();
            renderGraph();
            renderJobCards();
            renderCrossLinks();
            lucide.createIcons();
            applyTransform();
        }

        function renderHeader() {
            document.title = `AI-Learn - ${currentCat.name}`;
            document.getElementById('breadcrumbCat').textContent = currentCat.name;
            document.getElementById('catTitle').textContent = currentCat.name;
            document.getElementById('catDesc').textContent = `${catJobs.length} occupations • ${catJobs.reduce((s, j) => s + j.skills, 0)} total skills`;
            document.getElementById('nodeCount').textContent = `${catJobs.length} jobs`;

            // Icon
            const iconEl = document.getElementById('catIcon');
            iconEl.style.background = `linear-gradient(135deg,${currentCat.color}30,${currentCat.color}10)`;
            iconEl.style.borderColor = currentCat.color + '40';
            iconEl.innerHTML = `<i data-lucide="${currentCat.icon}" class="w-7 h-7" style="color:${currentCat.color}"></i>`;

            // Badges
            const sharedIn = catSharedWithin.reduce((s, l) => s + l.shared, 0);
            const sharedOut = catSharedCross.reduce((s, l) => s + l.shared, 0);
            document.getElementById('badgeSharedIn').textContent = `${sharedIn} shared within`;
            document.getElementById('badgeSharedOut').textContent = `${sharedOut} cross-category`;
            document.getElementById('statJobs').textContent = catJobs.length;
            document.getElementById('statSkills').textContent = catJobs.reduce((s, j) => s + j.skills, 0);
            document.getElementById('statSharedIn').textContent = sharedIn;
            document.getElementById('statSharedOut').textContent = sharedOut;
        }

        function renderSidebar() {
            const ul = document.getElementById('categoryList');
            ul.innerHTML = CATEGORIES.map(cat => {
                const cnt = JOBS.filter(j => j.cat === cat.id).length;
                const active = cat.id === currentCatId;
                return `<li>
                    <a href="mockup_category.html?cat=${cat.id}" class="flex items-center gap-2 px-2 py-1.5 rounded-lg transition-all ${active ? 'bg-white/10 border border-white/10' : 'hover:bg-white/5'}">
                        <span class="w-2.5 h-2.5 rounded-full shrink-0" style="background:${cat.color}"></span>
                        <span class="text-[11px] ${active ? 'text-white font-semibold' : 'text-slate-300'} flex-1 truncate">${cat.name}</span>
                        <span class="text-[9px] text-slate-600 font-mono">${cnt}</span>
                    </a>
                </li>`;
            }).join('');

            // Search
            document.getElementById('searchInput').addEventListener('input', e => {
                const q = e.target.value.toLowerCase();
                document.querySelectorAll('.job-node-g').forEach(el => {
                    const name = el.dataset.name.toLowerCase();
                    if (q && name.includes(q)) {
                        el.style.opacity = '1';
                        el.style.filter = 'drop-shadow(0 0 8px rgba(56,189,248,0.5))';
                    } else if (q) {
                        el.style.opacity = '0.2';
                        el.style.filter = '';
                    } else {
                        el.style.opacity = '1';
                        el.style.filter = '';
                    }
                });
            });
        }

        function renderGraph() {
            const svg = document.getElementById('svgLayer');
            const layer = document.getElementById('nodeLayer');
            let svgHtml = '';
            let nodeHtml = '';

            // Center cluster ring
            svgHtml += `<circle cx="${CX}" cy="${CY}" r="350" fill="${currentCat.color}04" stroke="${currentCat.color}10" stroke-width="1.5" stroke-dasharray="8"/>`;
            svgHtml += `<circle cx="${CX}" cy="${CY}" r="200" fill="${currentCat.color}03" stroke="${currentCat.color}08" stroke-width="1"/>`;

            // Within-category shared edges (yellow)
            catSharedWithin.forEach(link => {
                const ja = catJobs.find(j => j.id === link.a);
                const jb = catJobs.find(j => j.id === link.b);
                if (!ja || !jb) return;
                const opacity = Math.min(0.5, link.shared / 20);
                const width = 0.5 + (link.shared / 10);
                svgHtml += `<line x1="${ja.x}" y1="${ja.y}" x2="${jb.x}" y2="${jb.y}" stroke="rgba(250,204,21,${opacity})" stroke-width="${width}" class="edge-line"/>`;
                const mx = (ja.x + jb.x) / 2, my = (ja.y + jb.y) / 2;
                svgHtml += `<circle cx="${mx}" cy="${my}" r="12" fill="#1e293b" stroke="rgba(250,204,21,0.4)" stroke-width="1"/>`;
                svgHtml += `<text x="${mx}" y="${my + 4}" text-anchor="middle" fill="#facc15" font-size="8" font-weight="bold" font-family="Inter">${link.shared}</text>`;
            });

            // Cross-category edges (orange, pointing outward)
            catSharedCross.forEach(link => {
                const otherCatId = link.from === currentCatId ? link.to : link.from;
                const otherCat = CATEGORIES.find(c => c.id === otherCatId);
                // Place a phantom node at edge of the graph area pointing toward the other category
                const idx = CATEGORIES.indexOf(otherCat);
                const angle = (idx / CATEGORIES.length) * Math.PI * 2 - Math.PI / 2;
                const px = CX + Math.cos(angle) * 480;
                const py = CY + Math.sin(angle) * 380;
                const opacity = Math.min(0.4, link.shared / 20);
                svgHtml += `<line x1="${CX}" y1="${CY}" x2="${px}" y2="${py}" stroke="rgba(251,146,60,${opacity})" stroke-width="${0.5 + link.shared / 12}" stroke-dasharray="4 3" class="edge-line"/>`;
                // Cross-category badge
                const mx = (CX + px) / 2, my = (CY + py) / 2;
                svgHtml += `<circle cx="${mx}" cy="${my}" r="12" fill="#1e293b" stroke="rgba(251,146,60,0.4)" stroke-width="1"/>`;
                svgHtml += `<text x="${mx}" y="${my + 4}" text-anchor="middle" fill="#fb923c" font-size="8" font-weight="bold" font-family="Inter">${link.shared}</text>`;
                // Ghost category node
                nodeHtml += `
                <a href="mockup_category.html?cat=${otherCatId}" class="absolute flex flex-col items-center cursor-pointer group" style="left:${px - 24}px;top:${py - 24}px">
                    <div class="w-[48px] h-[48px] rounded-full flex items-center justify-center border opacity-40 group-hover:opacity-80 group-hover:scale-110 transition-all" 
                         style="background:${otherCat.color}15;border-color:${otherCat.color}30">
                        <i data-lucide="${otherCat.icon}" class="w-5 h-5" style="color:${otherCat.color}"></i>
                    </div>
                    <span class="text-[8px] mt-0.5 opacity-50 group-hover:opacity-100 transition-all whitespace-nowrap" style="color:${otherCat.color}">${otherCat.name}</span>
                </a>`;
            });

            // Center category icon
            nodeHtml += `
            <div class="absolute flex flex-col items-center" style="left:${CX - 35}px;top:${CY - 35}px;">
                <div class="w-[70px] h-[70px] rounded-full flex items-center justify-center shadow-xl border-2" style="background:linear-gradient(135deg,${currentCat.color}30,${currentCat.color}10);border-color:${currentCat.color}40;box-shadow:0 0 40px ${currentCat.color}20">
                    <i data-lucide="${currentCat.icon}" class="w-8 h-8" style="color:${currentCat.color}"></i>
                </div>
                <span class="text-[11px] font-bold mt-1.5 whitespace-nowrap" style="color:${currentCat.color}">${currentCat.name}</span>
            </div>`;

            // Job nodes
            catJobs.forEach((job, i) => {
                nodeHtml += `
                <div class="absolute job-node-g flex flex-col items-center node-float cursor-pointer" data-name="${job.name}" 
                     style="left:${job.x - 22}px;top:${job.y - 22}px;animation-delay:${i * 0.15}s"
                     onclick="window.location.href='mockup_generator.html?job=${job.id}'"
                     onmouseenter="showTooltip(event,'${job.name}','${job.skills} skills\\n${job.topSkills.join(', ')}')" onmouseleave="hideTooltip()">
                    <div class="w-[44px] h-[44px] rounded-full bg-slate-800/90 border-2 flex items-center justify-center hover:scale-125 transition-all shadow-lg" 
                         style="border-color:${currentCat.color}50;box-shadow:0 0 12px ${currentCat.color}15">
                        <div class="w-3 h-3 rounded-full" style="background:${currentCat.color}"></div>
                    </div>
                    <span class="text-[9px] text-slate-300 font-medium mt-1 text-center whitespace-nowrap">${job.name}</span>
                    <span class="text-[7px] text-slate-500">${job.skills} skills</span>
                </div>`;
            });

            svg.innerHTML = svgHtml;
            layer.innerHTML = nodeHtml;
        }

        function renderJobCards() {
            const container = document.getElementById('jobCards');
            container.innerHTML = catJobs.map(job => `
                <a href="mockup_generator.html?job=${job.id}" class="block p-3 rounded-xl bg-slate-800/30 border border-slate-700/30 hover:border-[${currentCat.color}]/40 hover:bg-slate-800/50 transition-all cursor-pointer group">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-6 h-6 rounded-full flex items-center justify-center shrink-0" style="background:${currentCat.color}20">
                            <div class="w-2 h-2 rounded-full" style="background:${currentCat.color}"></div>
                        </div>
                        <span class="text-[11px] text-slate-200 font-semibold group-hover:text-primary transition-colors">${job.name}</span>
                        <span class="text-[9px] text-slate-600 ml-auto font-mono">${job.skills}</span>
                    </div>
                    <div class="flex flex-wrap gap-1 ml-8">
                        ${job.topSkills.map(s => `<span class="text-[8px] px-1.5 py-0.5 rounded bg-slate-700/50 text-slate-400">${s}</span>`).join('')}
                    </div>
                </a>
            `).join('');
        }

        function renderCrossLinks() {
            const container = document.getElementById('crossLinks');
            container.innerHTML = catSharedCross.map(link => {
                const otherCatId = link.from === currentCatId ? link.to : link.from;
                const otherCat = CATEGORIES.find(c => c.id === otherCatId);
                return `
                <a href="mockup_category.html?cat=${otherCatId}" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-orange-500/5 border border-orange-500/10 hover:border-orange-500/30 transition-all group">
                    <div class="w-5 h-5 rounded-full shrink-0 flex items-center justify-center" style="background:${otherCat.color}20">
                        <i data-lucide="${otherCat.icon}" class="w-2.5 h-2.5" style="color:${otherCat.color}"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-[10px] text-slate-300 font-medium group-hover:text-orange-300 truncate">${otherCat.name}</p>
                        <p class="text-[8px] text-slate-600 truncate">${link.top}</p>
                    </div>
                    <span class="text-[9px] text-orange-400 font-bold shrink-0">${link.shared}</span>
                </a>`;
            }).join('');
        }

        // ============================================================
        //  INTERACTIONS
        // ============================================================
        // Pan
        let dragging = false, dsx, dsy;
        document.getElementById('graph').addEventListener('mousedown', e => {
            if (e.target.closest('a') || e.target.closest('[onclick]')) return;
            dragging = true; dsx = e.clientX - panX; dsy = e.clientY - panY;
        });
        window.addEventListener('mousemove', e => {
            if (!dragging) return;
            panX = e.clientX - dsx;
            panY = e.clientY - dsy;
            applyTransform();
        });
        window.addEventListener('mouseup', () => { dragging = false; });

        // Zoom
        document.getElementById('graph').addEventListener('wheel', e => {
            e.preventDefault();
            const delta = e.deltaY > 0 ? -0.04 : 0.04;
            scale = Math.max(0.3, Math.min(1.5, scale + delta));
            applyTransform();
        }, { passive: false });

        // Tooltip
        function showTooltip(e, title, desc) {
            const tt = document.getElementById('tooltip');
            document.getElementById('ttTitle').textContent = title;
            document.getElementById('ttDesc').textContent = desc;
            tt.style.left = (e.clientX + 12) + 'px';
            tt.style.top = (e.clientY - 10) + 'px';
            tt.classList.add('visible');
        }
        function hideTooltip() { document.getElementById('tooltip').classList.remove('visible'); }

        // ============================================================
        //  INIT
        // ============================================================
        window.addEventListener('DOMContentLoaded', renderAll);
        window.addEventListener('resize', applyTransform);
    </script>
</body>

</html>