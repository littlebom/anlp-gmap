<!DOCTYPE html>
<html lang="th" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Learn — เข้าสู่ระบบ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        background: '#0B1120',
                        surface: '#1E293B',
                        primary: '#38bdf8',
                        secondary: '#818cf8',
                        accent: '#2dd4bf'
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .bg-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        @keyframes pulseGlow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(56, 189, 248, 0.15);
            }

            50% {
                box-shadow: 0 0 40px rgba(56, 189, 248, 0.3);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        @keyframes orbit {
            from {
                transform: rotate(0deg) translateX(140px) rotate(0deg);
            }

            to {
                transform: rotate(360deg) translateX(140px) rotate(-360deg);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out both;
        }

        .card-glow {
            animation: pulseGlow 4s ease-in-out infinite;
        }

        .logo-float {
            animation: float 4s ease-in-out infinite;
        }

        .orbit-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            margin: -3px;
        }

        .orbit-1 {
            animation: orbit 12s linear infinite;
            background: #38bdf8;
            opacity: 0.4;
        }

        .orbit-2 {
            animation: orbit 18s linear infinite reverse;
            background: #818cf8;
            opacity: 0.3;
        }

        .orbit-3 {
            animation: orbit 25s linear infinite;
            background: #2dd4bf;
            opacity: 0.2;
        }

        .btn-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        input:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 30px #1E293B inset !important;
            -webkit-text-fill-color: #e2e8f0 !important;
        }
    </style>
</head>

<body class="bg-background text-slate-400 antialiased min-h-screen flex items-center justify-center overflow-hidden">
    <!-- Background effects -->
    <div class="fixed inset-0 bg-grid pointer-events-none z-0"></div>
    <div
        class="fixed top-1/4 left-1/4 w-[600px] h-[600px] bg-sky-500/5 blur-[150px] rounded-full pointer-events-none z-0">
    </div>
    <div
        class="fixed bottom-1/4 right-1/4 w-[500px] h-[500px] bg-violet-500/5 blur-[150px] rounded-full pointer-events-none z-0">
    </div>

    <!-- Orbit ring decoration -->
    <div
        class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[280px] h-[280px] rounded-full border border-slate-800/30 pointer-events-none z-0">
    </div>
    <div class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-0">
        <div class="orbit-dot orbit-1"></div>
        <div class="orbit-dot orbit-2"></div>
        <div class="orbit-dot orbit-3"></div>
    </div>

    <!-- Login Card -->
    <div class="relative z-10 w-full max-w-md px-4 fade-in">
        <div class="bg-slate-900/70 backdrop-blur-2xl border border-slate-800 rounded-3xl p-8 shadow-2xl card-glow">

            <!-- Logo -->
            <div class="flex flex-col items-center mb-8">
                <div
                    class="w-16 h-16 rounded-2xl bg-gradient-to-br from-sky-500 to-indigo-500 flex items-center justify-center shadow-xl shadow-sky-500/20 logo-float mb-4">
                    <i data-lucide="brain-circuit" class="w-8 h-8 text-white"></i>
                </div>
                <h1 class="text-2xl font-bold text-slate-100 tracking-tight">AI-Learn Galaxy</h1>
                <p class="text-sm text-slate-500 mt-1">เข้าสู่ระบบเพื่อเริ่มการเรียนรู้</p>
            </div>

            <!-- Error message -->
            <div id="errorMsg"
                class="hidden mb-4 px-4 py-3 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm flex items-center gap-2">
                <i data-lucide="alert-circle" class="w-4 h-4 shrink-0"></i>
                <span id="errorText"></span>
            </div>

            <!-- Success message -->
            <div id="successMsg"
                class="hidden mb-4 px-4 py-3 rounded-xl bg-green-500/10 border border-green-500/20 text-green-400 text-sm flex items-center gap-2">
                <i data-lucide="check-circle" class="w-4 h-4 shrink-0"></i>
                <span id="successText"></span>
            </div>

            <!-- Form -->
            <form id="loginForm" class="space-y-4">
                <!-- Email -->
                <div>
                    <label
                        class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1.5">Email</label>
                    <div class="relative">
                        <i data-lucide="mail"
                            class="w-4 h-4 text-slate-500 absolute left-3.5 top-1/2 -translate-y-1/2 pointer-events-none"></i>
                        <input type="email" id="email" required placeholder="you@example.com"
                            class="w-full pl-10 pr-4 py-3 rounded-xl bg-slate-800/80 border border-slate-700 text-slate-200 text-sm placeholder:text-slate-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/20 transition-all">
                    </div>
                </div>

                <!-- Password -->
                <div>
                    <label
                        class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1.5">Password</label>
                    <div class="relative">
                        <i data-lucide="lock"
                            class="w-4 h-4 text-slate-500 absolute left-3.5 top-1/2 -translate-y-1/2 pointer-events-none"></i>
                        <input type="password" id="password" required placeholder="••••••••"
                            class="w-full pl-10 pr-4 py-3 rounded-xl bg-slate-800/80 border border-slate-700 text-slate-200 text-sm placeholder:text-slate-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/20 transition-all">
                    </div>
                </div>

                <!-- Remember + Forgot -->
                <div class="flex items-center justify-between text-sm">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox"
                            class="w-3.5 h-3.5 rounded border-slate-600 bg-slate-800 text-primary focus:ring-primary/20">
                        <span class="text-slate-500 text-xs">จดจำฉัน</span>
                    </label>
                    <a href="#" class="text-xs text-primary/70 hover:text-primary transition-colors">ลืมรหัสผ่าน?</a>
                </div>

                <!-- Login Button -->
                <button type="submit" id="loginBtn"
                    class="relative w-full py-3 rounded-xl bg-gradient-to-r from-sky-500 to-indigo-500 text-white font-semibold text-sm shadow-lg shadow-sky-500/25 hover:shadow-sky-500/40 hover:scale-[1.02] active:scale-[0.98] transition-all overflow-hidden">
                    <span id="loginBtnText" class="relative z-10 flex items-center justify-center gap-2">
                        <i data-lucide="log-in" class="w-4 h-4"></i>
                        เข้าสู่ระบบ
                    </span>
                    <div class="absolute inset-0 btn-shimmer pointer-events-none"></div>
                </button>
            </form>

            <!-- Divider -->
            <div class="flex items-center gap-3 my-6">
                <div class="flex-1 h-px bg-slate-800"></div>
                <span class="text-[10px] text-slate-600 uppercase tracking-widest">หรือ</span>
                <div class="flex-1 h-px bg-slate-800"></div>
            </div>

            <!-- Register link -->
            <div class="text-center">
                <p class="text-sm text-slate-500">
                    ยังไม่มีบัญชี?
                    <a href="mockup_register.html" class="text-primary font-medium hover:underline">สมัครสมาชิก</a>
                </p>
            </div>
        </div>

        <!-- Footer -->
        <p class="text-center text-[10px] text-slate-700 mt-6">
            ANLP-GSM · AI-Native Adaptive Learning Platform · v2.0
        </p>
    </div>

    <script>
        lucide.createIcons();

        // API Base URL (adjust if needed)
        const API_BASE = window.location.port === ''
            ? 'http://localhost:3000'
            : `${window.location.protocol}//${window.location.hostname}:3000`;

        // Check if already logged in
        const token = localStorage.getItem('anlp_token');
        if (token) {
            // Verify token is still valid
            fetch(`${API_BASE}/auth/me`, {
                headers: { 'Authorization': `Bearer ${token}` }
            })
                .then(r => { if (r.ok) window.location.href = 'mockup_galaxy.html'; })
                .catch(() => localStorage.removeItem('anlp_token'));
        }

        // Check for registration success message
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('registered') === 'true') {
            showSuccess('สมัครสมาชิกสำเร็จ! กรุณาเข้าสู่ระบบ');
        }

        // Handle login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessages();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('loginBtn');
            const btnText = document.getElementById('loginBtnText');

            // Loading state
            btn.disabled = true;
            btnText.innerHTML = '<svg class="animate-spin w-4 h-4" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4" stroke-linecap="round"/></svg> กำลังเข้าสู่ระบบ...';

            try {
                const res = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.error || 'เข้าสู่ระบบไม่สำเร็จ');
                }

                // Save token & user
                localStorage.setItem('anlp_token', data.token);
                localStorage.setItem('anlp_user', JSON.stringify(data.user));

                // Redirect to Galaxy View
                showSuccess('เข้าสู่ระบบสำเร็จ! กำลังเปลี่ยนหน้า...');
                setTimeout(() => {
                    window.location.href = 'mockup_galaxy.html';
                }, 800);

            } catch (err) {
                showError(err.message);
                btn.disabled = false;
                btnText.innerHTML = '<i data-lucide="log-in" class="w-4 h-4"></i> เข้าสู่ระบบ';
                lucide.createIcons();
            }
        });

        function showError(msg) {
            const el = document.getElementById('errorMsg');
            document.getElementById('errorText').textContent = msg;
            el.classList.remove('hidden');
        }

        function showSuccess(msg) {
            const el = document.getElementById('successMsg');
            document.getElementById('successText').textContent = msg;
            el.classList.remove('hidden');
        }

        function hideMessages() {
            document.getElementById('errorMsg').classList.add('hidden');
            document.getElementById('successMsg').classList.add('hidden');
        }
    </script>
</body>

</html>